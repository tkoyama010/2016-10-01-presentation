# Windows Subsystem for Linux（WSL）を使用したWindows10へのGetfem++の導入
## はじめに
Windows10ではWindows Subsystem for Linuxが入ったことにより、UbuntuがWindows上で使用可能になりました。
それにより、Getfem++64bit版ののPythonインターフェースがWindowsでも使用可能となりました。
今回は解析事例の紹介の前座としてインストール方法についてご紹介します。
## Windows Subsystem for Linux（WSL）の導入方法
### Windows10 Anniversary Update
WSLをインストールするためにはWindows10においてAnniversaryUpdateを実行します。
Windows10 AnniversaryUpdateはこちらのサイトからダウンロードします。
### Windows Subsystem for Linux（WSL)の有効化
WSLは"Windowsの機能"有効にすることができます。
## Getfem++のインストール方法
### bashの起動
以上でインストールしたLinuxを使用してGetfem++のpythonインターフェースをインストールします。
先ほどのインストールでbashがインストールされているのでそれを起動します。
### python-getfem++パッケージのインストール方法
pythonインターフェスのインストール方法はUbuntuと同一です。
インストール前に sudo apt-get update; sudo apt-get dist-upgradeでまずパッケージをアップデートします。
次に、sudo apt-get install python-getfem++によりGetfem++のpythonインターフェースをインストールします。
### プリポストソフトのインストール
プリポストにはGmshとParaviewをインストールします。
これにより、Getfem++のプリ処理とポスト処理が可能になります。
XWindowsを使う際にはXmingをインストールしておきます。
これにより、WSLから転送されるXWindowを表示することが可能です。
WSL側では、こちらに示す設定を行うことでXWindowが転送されます。
## Getfem++5.1のインストール
### Getfem++5.1の説明
前のスライドでGetfem++のpythonインターフェースのインストール方法を紹介しましたが、この方法でインストールされるパッケージは最新版ではありません。
そこで、最新版のGetfem++をインストールする方法についても説明します。
今年の8月にGetfem++5.1がリリースされました。
これはGetfem++5.0からのマイナーアップデートです。
### ダウンロード
まずはGetfem++version5.0のtarファイルをダウンロードします。
### コンパイルとテスト実行
次に適当なデイレクトリでダウンロードしたファイルを解凍します。
解凍したディレクトリで./configureコマンドを実行します。
64bitのPCでコンパイルする際には--with-picオプションをつけます。
このコマンドにより現在のUbuntuの環境にインストールするべきソフトが表示されますので１つずつ表示していきます。
環境が整ったらmakeとmake checkコマンドでコンパイルとテスト実行が可能です。
### コンパイルに必要なライブラリ
コンパイルには以下のライブラリが必要になります。
どのライブラリもaptitudeコマンドで検索、インストール可能です。
Qhullはメッシュに使用されるライブラリ、Mumpsは大規模疎行列のためのライブラリです。
また、線形行列ソルバーとしてお馴染みのlapackとblasも必要です。
## Getfem++の開発版の導入方法
Getfem++5.1のインストール方法を紹介しましたが、現在開発中の開発版をインストールすることが可能です。
### Subversionについて
Getfem++はこのリポジトリでsubversionにより開発されています。
これをチェックアウトすることにより、最新版のGetfem++がダウンロードされます。
./autogen.sh実行後（libtoolizeのインストールが必要）のコンパイルとテスト実行はリリース版と全く同一です。
## まとめ
ここでまでの話をまとめます。
Windows10の最新バージョンでUbuntuが使用可能になりました。
それによりGetfem++ソルバーのpythonインターフェース及びプリポストのgmshとParaviewがインストール可能になりました。
Xmingを使うことにより、WSLのGUIをWindows上でも使用可能になり、gmshとParaviewを起動することができます。
ただ、これによりインストールされるGetfem++は最新のものではないため最新の5.1と開発版のインストール方法を紹介しました。
# Getfem++事例紹介：平面波斜め入射時の水平成層地盤を対象とした時刻歴応答解析の定式化と検証 ２次元面内波への拡張
以上で説明したGetfem++を使用して、現在水平成層地盤を対象として時刻歴応答解析の定式化と検証を行っていますのでその内容についてつづけてご紹介します。
## はじめに
通常の１次元地盤の解析においてはバネマスモデルの時刻歴解析が一般的に行われています。
これは水平方向の状態が一様な解析であるため、平面波の鉛直入射解析に相当します。
一方、入射角を持つ平面波斜め入射解析については振動数領域において薄層方程式による解析がおこなわれているものの、時間領域での解析事例は見当たりません。
これは、薄層法における波数部分が時間領域の定式化に変換する手法が提案されていなかったためです。
## 既往の開発
そこで、本研究では振動数領域における波数部分を、時間微分に変換する定式化を行います。
これにより、地盤の斜め入射解析においても地盤の材料非線形などを考慮することが可能となり、より精度のよい解析ができるようになることが期待されます。
また定式化による計算手法の変更もこれから説明する簡易な方法で対応可能です。
## 拡張方針
前回までの拡張方針を踏まえ、今回は２次元問題への拡張を行います。
### 側面の自由地盤解析
側面の自由地盤には、前回開発した１次元解析手法を使用します。
底面部分に入射波を入力し、各節点での変位を計算します。
応答値は独立に１次元解析を行い、それをファイルに保存して２次元解析で強制変位として側面に入力しています。
これは、Getfem++が複数の微分方程式を使用した連成解析に対応していないためです。
### 切り欠き力(応力)の計算
２次元地盤の側面に強制変位を与える場合には同時に応力状態も再現する必要があります。
これは、側面から強制変位を入力する際に側方の応力を入力する必要があるためです。
そこで、これについても１次元解析の場合と同様に波数部分を変換することにより斜め入射時の応力を計算します。
### 底面入射
以上が側面からの入力についてです。
次に底面からの平面波の入力について説明します。
底面については１次元解析と同様の入射を行います。
このインピーダンスは下方向に半無限地盤を仮定しています、そのため反射を気にする必要がありません。
しかしながら、全反射の場合においては虚数項となるため実数での直接積分法を適用することができません。
## 定式化
切り欠き力の計算と底面入射の定式化結果はこちらのようになります。
この定式化結果から分かるように、質量項と減衰項に変更を加えることにより計算可能であることが分かります。
### 側面の自由地盤解析
側面の自由地盤は前回紹介した１次元解析と同じ定式化を使用します。
### 切り欠き力(応力)の計算
また、切り欠き力はこちらの定式化を使用します。
応力計算の際には面外方向には定常状態を仮定しているためY方向の微分項は0.0になります。
一方、面内方向の水平に関する微分は前回の一次元解析と同様にこのように変換が可能なため、計算が可能です。
### 底面入射
底面への入射に使用するインピーダンスはこのように定式化されます。
この式は１次元の底面入射と同様でそれに単位面積を掛けあわせます。
## 実装方法
実装には前回と同様にGetfemを使用します。
### 側面の自由地盤解析
側面の自由地盤は１次元解析と同一であるため、前回の一次元解析のスクリプトと同一のものを使用します。
### 切り欠き力(応力)の計算
その際に応力状態も同時に計算します。
これには、先ほど示した定式化を基にした計算方法で応力を計算します。
### 底面入射
メッシュオブジェクトを作成し、底面部分の領域BOTTOMを作成します。
底面部分には担当面積を掛けあわせた粘着力を入力するためasmboundarysource関数を使用します。
## 解析検証条件
解析条件は半無限地盤と２層地盤の解析を行いました。
### 地盤条件と入射波
地盤の物性値はそれぞれこちらのようになります。
また、入射波は一次元解析の時と同様にリッカー波の速度波形を使用します。
### 理論解に関する説明
今回はSV波の入射波を使用しているため、表面からの反射の際にはSV波が入射されると、この図のようにSV波とP波が反射されます。
今回はこの現象を再現します。
## 解析結果
こちらが解析結果となります。
### 半無限地盤の場合
半無限地盤の場合、先ほど説明したようにP波とSV波が反射される結果となります。
### ２層地盤の場合
２層地盤の場合も、P波とSV波が反射されこのような結果となります。
## 今後の課題(2.5次元問題)
### 課題概要
今回の２次元解析は今後３次元に拡張する予定です。
その際に入射方位角も設定します。
### 解決方針
その際には今回と同様に変位と応力を計算しますが2.5次元解析を行います。
この解析を行う際には2.5次元解析を行います。
波数はこちらの図に示すように変換されます。
この関係を使用すると、2.5次元解析は座標変換問題に変換されます。
## 今後の課題(全反射問題)
### 課題概要
先ほどの入射の説明にあったように現在の地震波の入射方法では全反射に対応できません。
これは、入射のインピーダンスが虚数になるためです。
### 解決方針
インピーダンスは虚数となるため、直接積分法の計算が行えません。
そこで今後の解決の方針としてPLMを底面部分に設定することを考えます。
PMLを底面境界として使用した例としては、１次元解析の底面に適用した例があります。
この際の定式化はこちらに示すような形で行っています。
地震波の入力を変位で行い、下降方法の地震波はPMLで行います。
## まとめ
以上が今回の報告になります。
得られた知見をまとめます。
開発した１次元解析の斜め入射解析を基に２次元解析の定式化と開発・検証を行いました。
検証として一様地盤と２層地盤の解析を行い、妥当な結果が得られていることを確認しました。
今後は全反射の現象再現及び、３次元解析の解析への拡張を行う方針です。

